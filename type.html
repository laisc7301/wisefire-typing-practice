<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>睿火打字练习</title>
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
		<link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">

		<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
		<script src="./js/cookie.js"></script>
		<script src="./js/replacehhf.js"></script>
		<style>
			.main {
				background-color: chartreuse;
			}

			.main2 {
				/* background-color: deepskyblue; */
				background-color: lightskyblue;

				overflow: auto;

				/* border-style: solid;
				border-width: 5px;
				border-color: white; */

			}

			.main3 {}

			.footer {
				text-align: center;
				background-color: lightskyblue;
			}


			.title1 {
				/* background-color: deepskyblue; */
				background-color: #00bfff;
				/* background-color: red; */
				/* deepskyblue */
				font-size: 20px;
				text-align: center;

				top: 0;
				left: 0;
				border-style: none none solid none;
			}

			.inputtipdiv {

				border-style: none none none solid;
			}

			.texttest1 {
				font-size: 30px;
				text-overflow: "";
				overflow: hidden;
				white-space: nowrap;
				/* display: none; */

			}

			.entertext {
				font-size: 30px;
			}

			/* .inputdiv1 {
				color: red;
			} */



			.bgline1 {
				/* background-color: lightskyblue;
				border-color: lightskyblue; */
				background-color: #87cefa;
				/* lightskyblue */
				border-color: #87cefa;
			}

			.bgline2 {
				/* background-color: chartreuse;
				border-color: chartreuse; */
				background-color: #87cefa;
				/* lightskyblue */
				border-color: #87cefa;
			}

			.fblack {
				color: black;
			}

			.fgrey {
				color: grey;
			}

			.fred {
				color: red;
			}

			.floatright {
				float: right;
			}


			;
		</style>
		<script>
			var version = "v1.1.0";

			var article = replacebrtohhf(getCookie("article"));
			//var entered = "123\nOnce upon a time a little girl tried to make a living by selling matches in the stre";
			var entered = replacebrtohhf(getCookie("entered"));

			var myinputobj = new Array(); //输入内容列表(input)
			var inputtipobj = new Array(); //输入提示列表(div)
			var list = new Array(); //每行要输入的内容
			var listentered = new Array(); //已输入的每行的内容，仅加载时更新
			var nowfocus = 0; //现在的焦点
			//var onbackspace = false; //是否触发了退格到上一行
			var articletitle = getCookie("articletitle"); //文章名
			var isinputing = false;
			let time0 = getCookie("time");
			var time = 0;
			if (time0 == "") {
				time = 0;
			} else {
				time = time0;
			}
			let autonextline0 = getCookie("autonextline");
			var autonextline = false;
			if (autonextline0 == "") {
				autonextline = false;
			} else {
				autonextline = (autonextline0 == "true");
			}

			let fontsize0 = getCookie("fontsize");
			var fontsize = 30;
			if (fontsize0 == "") {
				fontsize = 30;
			} else {
				fontsize = fontsize0;
			}

			var defaulttitlecolor = "#00bfff";
			//var defaulttitlecolor = "green";

			let titlecolor0 = getCookie("titlecolor");
			var titlecolor = defaulttitlecolor;
			if (titlecolor0 == "") {
				titlecolor = defaulttitlecolor;
			} else {
				titlecolor = titlecolor0;
			}

			var defaultline1color = "#87cefa";
			let line1color0 = getCookie("line1color");
			var line1color = defaultline1color;
			if (line1color0 == "") {
				line1color = defaultline1color;
			} else {
				line1color = line1color0;
			}


			var defaultline2color = "#82ff92";
			let line2color0 = getCookie("line2color");
			var line2color = defaultline2color;
			if (line2color0 == "") {
				line2color = defaultline2color;
			} else {
				line2color = line2color0;
			}

			var iscolorreg = /^#[0-9A-F]{6}$/i;



			var isShowSpeed0 = getCookie("isshowspeed");

			var isShowSpeed = true;

			if (isShowSpeed0 == "true" || isShowSpeed0 == true || isShowSpeed0 == "") {
				isShowSpeed = true;
				setCookie("isshowspeed", true, 0);
			} else {
				isShowSpeed = false;
			}



			var speedLengthArray = new Array(); //记录每秒输入字符长度

			var speedSpacing = 15; //测试速度间隔

			for (let i = 0; i <= speedSpacing; i++) {
				speedLengthArray[i] = entered.length;

			}

			var speed = 0;

			// var isfinishdialogshowed = false;
			// var issettingModalshowed = false;
		</script>

	</head>
	<body>
		<div class="main">
			<div class="title1">
				标题栏
			</div>
			<div class="main2">
				<div class="texttest1">
					Loading...
				</div>
				<div class="main3">
				</div>

			</div>
			<div class="footer">
				由&nbsp;<a href="https://laisc7301.github.io/blog/" target="_blank">睿虎</a>&nbsp;开发&nbsp;<span
					class="version">v1.0.0</span>&nbsp;<a href="https://github.com/laisc7301/wisefire-typing-practice/"
					target="_blank">源代码</a>
			</div>

		</div>
		<style>
			.finishdialog {
				top: 0;
				left: 0;
				/* right: 0;
				bottom: 0; */

				position: fixed;
				z-index: 100;

				background-color: #F4FFEF;
				border: 1px dotted black;
				display: none;

			}

			.finishdialog-title {
				font-weight: bold;
			}

			.finishdialog-okbutton {
				text-align: center;
			}
		</style>
		<div class="finishdialog">
			<div class="finishdialog-title">打字完成！</div>
			<br />
			<div class="finishdialog-usedtime">用时：</div>
			<div class="finishdialog-correctrate">正确率：</div>
			<div class="finishdialog-totalinput">输入字数：</div>

			<br />
			<div class="finishdialog-okbutton">

				<button class="btn btn-primary" onclick="onfinishdialogok()">确定</button>
			</div>
		</div>

		<style>
			.settingModal-tip1 {
				border-style: solid none solid none;
				border-width: 7px;
				border-color: #ffffff;
			}

			.colortext {
				display: inline;
				width: 120px;

			}
		</style>






































		<div class="modal fade" id="settingModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">设置</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" onclick="onsettingModalCancel()"></button>
					</div>
					<div class="modal-body">
						<div class="input-group mb-3">
							<span class="input-group-text" id="inputGroup-sizing-default">字体大小(px)：</span>
							<input type="text" class="form-control setting-fontsize" aria-label="Sizing example input"
								aria-describedby="inputGroup-sizing-default"><span
								class="settingModal-tip1">（默认30）</span>
						</div>

						<div>
							显示打字速度：
							<input class="form-check-input ifshowspeed" type="checkbox" value="" id="flexCheckChecked"
								checked>
							<label class="form-check-label" for="flexCheckChecked">
								开启
							</label>

						</div><br />




						<!-- is-invalid -->

						<div>标题栏颜色：<input class="form-control form-control-sm colortext colortext-title"
								oninput="onchangetitlecolortext()" />

							<button type="button" class="btn btn-primary"
								style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
								onclick="titlecolortodefault()">
								恢复默认
							</button>

							<input type="color" class="form-control form-control-color titlecolorset" value="#ff0000"
								title="标题栏颜色" oninput="onchangetitlecolor(this)" />
						</div>

						<div>单数行颜色：<input class="form-control form-control-sm colortext colortext-line1"
								oninput="onchangeline1colortext()" />

							<button type="button" class="btn btn-primary"
								style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
								onclick="line1colortodefault()">
								恢复默认
							</button>

							<input type="color" class="form-control form-control-color line1colorset" value="#ff0000"
								title="单数行颜色" oninput="onchangeline1color(this)" />
						</div>

						<div>双数行颜色：<input class="form-control form-control-sm colortext colortext-line2"
								oninput="onchangeline2colortext()" />

							<button type="button" class="btn btn-primary"
								style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
								onclick="line2colortodefault()">
								恢复默认
							</button>

							<input type="color" class="form-control form-control-color line2colorset" value="#ff0000"
								title="双数行颜色" oninput="onchangeline2color(this)" />
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" onclick="onsettingModalCancel()" data-bs-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" onclick="onsettingModalSave()">保存</button>
					</div>
				</div>
			</div>
		</div>





	</body>
	<script>
		function createpage0() {
			let windowwidth = window.innerWidth;
			let windowheight = window.innerHeight;

			$(".title1").width(windowwidth);
			//$(".main").width(windowwidth-25);
			let title1 = document.getElementsByClassName("title1")[0];
			let footer = document.getElementsByClassName("footer")[0];
			//$(".cube1").height(title1.clientHeight);
			let main2height = windowheight - title1.clientHeight - footer.clientHeight - footer.clientHeight;

			if (main2height <= 0) {
				main2height = 1;
			}

			$(".main2").height(main2height);

			let mytitle = document.getElementsByClassName("title1")[0];
			mytitle.style.backgroundColor = titlecolor;
			setline1color(line1color);
			setline2color(line2color);


			//$(".entertext").resize(100);
			// var entertextcss = document.querySelector('.entertext');
			// entertextcss.style.fontSize = 50;

			$(".version").html(version);
			
			$('#settingModal').on('hidden.bs.modal', function () {
			  onsettingModalCancel();
			});

		}
		createpage0();



		function starttimer() {
			var timer1 = self.setInterval("mytime()", 1000); //计算已用时间
			var timer2 = self.setInterval("mytime2()", 1000); //计算打字速度
		}
		starttimer();




		function texttest() { //测试最大长度
			var texttest = document.getElementsByClassName("texttest1")[0];
			texttest.style.fontSize = fontsize + "px";
			for (let i = 0; i < article.length; i++) {
				for (let i2 = i; i2 <= article.length; i2++) {

					if (i2 >= article.length) {
						list.push(article.substring(i, i2));
						i = i2 - 1; //-1是用来抵消掉i++
						break;
					}

					if (article.charAt(i2) == "\n") {
						list.push(article.substring(i, i2 + 1));
						i = i2 + 1 - 1; //-1是用来抵消掉i++
						break;
					}

					let myline = article.substring(i, i2);
					$(".texttest1").html(myline);
					if (texttest.scrollWidth > texttest.clientWidth) {
						i2 -= 3; //微调每行长度
						if (i2 <= 0) {
							break;
						}
						let myline2 = article.substring(i, i2);
						i = i2 - 1; //-1是用来抵消掉i++
						list.push(myline2);
						break;

					}
				}
			}
			texttest.innerHTML = "";
		}
		texttest();
		//console.log(list);


		function createpage() { //创建页面
			for (let i = 0; i < list.length; i++) {
				var inputtip = document.createElement("div");
				inputtip.style.fontSize = "50px";
				inputtip.innerHTML = "11";
				inputtip.className = "entertext inputtipdiv inputtipdiv" + i;
				if ((i + 1) % 2 === 0) {
					//console.log('是偶数');
					//inputtip.className += " bggreen";
					inputtip.className += " bgline2";
				} else {
					//console.log('是奇数');
					inputtip.className += " bgline1";
				}
				inputtip.setAttribute("lineid", i);

				var myinput = document.createElement("input");
				myinput.value = "";
				myinput.className = "entertext myinput myinput" + i;
				myinput.setAttribute("lineid", i); //当前页的行数，从0开始
				myinput.oninput = function() {
					oninput(this);
				}
				myinput.onkeydown = function(event) {
					onkeydown(event, this);
				}
				myinput.onfocus = function() {
					onfocus(this);
				}

				$(".main3").append(inputtip);
				$(".main3").append(myinput);
				inputtipobj.push(inputtip);
				myinputobj.push(myinput);

			}
			$(".myinput").width($(".main3").width() - 10);
			// 	let main3 = document.getElementsByClassName("main3")[0];
			// 	$(".main1").height(main3.scrollHeight);

			document.onkeydown = function(event) {
				windowonkeydown(event);

			}

			for (let i = 0; i < list.length; i++) {
				let tip = document.getElementsByClassName("inputtipdiv")[i];
				let myinput = document.getElementsByClassName("myinput")[i];
				tip.style.fontSize = fontsize + "px";
				myinput.style.fontSize = fontsize + "px";
			}



		}
		createpage();

		function getenteredlist() { //将过去的输入内容转换为列表
			let myline = 0;
			//let mylinelength = 0;

			let now = 0;
			for (;;) {
				//console.log(myline);
				let mylinelength = list[myline].length;
				listentered.push(entered.substring(now, now + mylinelength));
				//myinputobj[myline].setAttribute("nowentered",
				now += mylinelength;
				if (myline < list.length - 1) {
					myline++;
				}
				if (now >= entered.length) {
					break;
				}
			}
			let endoflistentered = listentered[listentered.length - 1];
			//console.log(endoflistentered);
		}
		getenteredlist();
		//console.log(listentered);


		function loadtipandinput() {
			for (let i = 0; i < list.length; i++) {
				inputtipobj[i].innerHTML = "";
				myinputobj[i].setAttribute("nowentered", strtonoenterend(getlistentered(i)));
				myinputobj[i].setAttribute("enteredtip", strtonoenterend(getlist(i)));
				myinputobj[i].setAttribute("ifneedenter", isenterend(getlist(i)));
				myinputobj[i].value = strtonoenterend(getlistentered(i));
				let mylist = strtonoenterend(getlist(i));
				for (let i2 = 0; i2 < mylist.length; i2++) {
					var inputtipspan = document.createElement("span");
					inputtipspan.className = "inputtipspan fblack " + "tipfont" + i + "-" + i2;
					let str = mylist.charAt(i2);
					if (str == " ") {
						str = "&nbsp;";
					}
					inputtipspan.innerHTML = str;
					inputtipobj[i].appendChild(inputtipspan);
				}
				setcolor(i);

			}
			let focusline = listentered.length - 1;
			if (focusline > list.length - 1) {
				focusline = list.length - 1;
			}
			myinputobj[focusline].focus();

			writetitle(articletitle, time, getcorrectrate());
			createpage0();
		}
		loadtipandinput();





		function setcolor(index) {
			let nowentered = myinputobj[index].getAttribute("nowentered");
			let enteredtip = myinputobj[index].getAttribute("enteredtip");
			for (let i = 0; i < enteredtip.length; i++) {
				let obj = document.getElementsByClassName("tipfont" + index + "-" + i)[0];
				if (i >= nowentered.length) {
					obj.className = "inputtipspan fblack " + "tipfont" + index + "-" + i;
				} else if (nowentered.charAt(i) == enteredtip.charAt(i)) {
					obj.className = "inputtipspan fgrey " + "tipfont" + index + "-" + i;
				} else {
					obj.className = "inputtipspan fred " + "tipfont" + index + "-" + i;
				}

			}
		}

		function getinputrightnumber(index) {
			let number = 0;
			let nowentered = myinputobj[index].getAttribute("nowentered");
			let enteredtip = myinputobj[index].getAttribute("enteredtip");
			for (let i = 0; i < nowentered.length; i++) {
				if (nowentered.charAt(i) == enteredtip.charAt(i)) {
					number++;
				}
			}
			return number;
		}
		//console.log(getinputrightnumber(3));

		function getinputnumber(index) {
			let nowentered = myinputobj[index].getAttribute("nowentered");
			return nowentered.length;
		}
		//console.log(getinputnumber(3));

		function isenterend(str) { //测试结尾是否为换行符
			return (str.charAt(str.length - 1) == "\n");
		}


		function strtonoenterend(str) { //去除结尾的换行符
			if (isenterend(str)) {
				return str.substring(0, str.length - 1);
			} else {
				return str;
			}
		}

		function getlist(index) { //获得list列表
			if (list[index] == undefined) {
				return "";
			} else {
				return list[index];
			}
		}

		function getlistentered(index) { //获得listentered列表,只有初始化时可用
			if (listentered[index] == undefined) {
				return "";
			} else {
				return listentered[index];
			}
		}

		function getifneedenter(index) {
			let booleanstr = myinputobj[index].getAttribute("ifneedenter");
			let myboolean = (booleanstr == "true");
			return myboolean;
		}

		function getentercontent(index) {
			let nowentered = myinputobj[index].getAttribute("nowentered");
			let enteredtip = myinputobj[index].getAttribute("enteredtip");
			let ifneedenter = getifneedenter(index);
			let enteredtiplength = enteredtip.length;
			if (nowentered.length == enteredtiplength) {
				if (ifneedenter) {
					return nowentered + "\n";
				} else {
					return nowentered;
				}
			} else {
				return nowentered;
			}
		}

		function getendline() {
			for (let i = list.length - 1; i >= 0; i--) {
				if (myinputobj[i].value != "") {
					return i;
				}

			}
			return 0;
		}

		//console.log(getentercontent(4)+"123");

		function oninput(myobj) {
			//let line = myobj.getAttribute("lineid");
			isinputing = true;
			myobj.setAttribute("nowentered", myobj.value);
			setcolor(nowfocus);
			let nowline = myobj.getAttribute("lineid");
			// console.log(isenterend(list[nowline]));
			if ((myobj.value.length >= myobj.getAttribute("enteredtip").length)) {

				//&& (isenterend(list[nowline]) == false)
				if (!(isenterend(list[nowline]))) {
					if (autonextline == true) {

						if (nowfocus < list.length - 1) { //如果不是最后一行
							if (myobj.selectionStart >= myobj.value.length) {
								nowfocus++;
								myinputobj[nowfocus].focus();
							}
						}
					} else {
						let endstr = myobj.value.substring(myobj.value.length - 1, myobj.value.length);
						// if (endstr == " ") {
						// 	myobj.value = myobj.value.substring(0, myobj.value.length - 1);
						// 	nowfocus++;
						// 	myinputobj[nowfocus].focus();
						// }
						let myregular = /[A-Za-zü']+/;
						if (myregular.test(endstr)) {
							// console.log('该字符串是英文' + endstr);
						} else {
							// console.log('该字符串不是英文' + endstr);
							// myobj.value = myobj.value.substring(0, myobj.value.length - 1);
							if (nowfocus + 1 < list.length) {
								if (myobj.selectionStart >= myobj.value.length) {
									nowfocus++;
									myinputobj[nowfocus].focus();
								}
							}
						}
					}
				}

				if (!(isenterend(list[nowline]))) {

					if (nowfocus < list.length - 1) { //如果不是最后一行

					} else { //如果是最后一行
						//onfinish();

						if (autonextline == true) {
							if (myobj.selectionStart >= myobj.value.length) {
								onfinish();
							}
						} else {
							let endstr = myobj.value.substring(myobj.value.length - 1, myobj.value.length);
							let myregular = /[A-Za-zü']+/;
							if (myregular.test(endstr)) {
								// console.log('该字符串是英文' + endstr);
							} else {
								// console.log('该字符串不是英文' + endstr);
								// myobj.value = myobj.value.substring(0, myobj.value.length - 1);
								if (myobj.selectionStart >= myobj.value.length) {
									onfinish();
								}
							}
						}
					}
				}
			}

			entered = getallentercontent();
			let str = replacehhftobr(entered);
			setCookie("entered", str, 36500);

			//console.log(myobj.selectionStart + "," + myobj.selectionEnd);


			// if(backspace){
			// 	backspace=false;
			// 	console.log(123);
			// 	nowfocus--;
			// 	myinputobj[nowfocus].focus();
			// }
			// console.log(ifpinyinend(myobj.value));
		}


		function ifpinyinend(str) {
			let endstr = str.substring(str.length - 1, str.length);
			let myregular = /[A-Za-zü']+/;
			return myregular.test(endstr);
		}

		function getcorrectrate() { // 获得正确率
			let allnumber = 0;
			let rightnumber = 0;
			for (let i = 0; i < list.length; i++) {
				allnumber += getinputnumber(i);
				rightnumber += getinputrightnumber(i);
			}
			if (allnumber == 0) {
				return 100;
			}
			let percentage1 = rightnumber / allnumber;
			let percentage2 = Math.round(percentage1 * 100 * 100) / 100;
			return percentage2;
		}

		function onkeydown(event, myobj) {
			//console.log(event.keyCode);
			if (event.keyCode == 13) { // Enter键
				if (nowfocus < list.length - 1) {
					nowfocus++;
					myinputobj[nowfocus].focus();
				} else {
					//到达最后一行
					onfinish();
				}
				//console.log(getendline());
			}

			if (event.keyCode == 8) { // Backspace键
				//console.log(myobj.selectionEnd);
				if (myobj.selectionEnd == 0 && nowfocus > 0) {
					nowfocus--;

					myinputobj[nowfocus].focus();
					event.preventDefault();
					let l = myinputobj[nowfocus].value.length;
					myinputobj[nowfocus].setSelectionRange(l, l);
				}
			}

			if (event.keyCode == 40) { // 下方向键
				if (nowfocus < list.length - 1) { // 如果不是最后一行
					nowfocus++;
					myinputobj[nowfocus].focus();
				}
			}
			if (event.keyCode == 38) { // 上方向键
				if (nowfocus > 0) { // 如果不是第一行
					nowfocus--;
					myinputobj[nowfocus].focus();
				}
			}
			if (event.keyCode == 16) { // shift键
				//console.log(myinputobj[nowfocus].selectionEnd);

			}

			if (event.keyCode == 39) { // 右方向键
				if (myinputobj[nowfocus].selectionEnd == myinputobj[nowfocus].value.length) {
					if (myinputobj[nowfocus].selectionStart == myinputobj[nowfocus].selectionEnd) {
						if (nowfocus < getendline()) {
							nowfocus++;
							myinputobj[nowfocus].focus();
						} else if (nowfocus == getendline()) {
							if (getifneedenter(nowfocus) == false) {
								nowfocus++;
								myinputobj[nowfocus].focus();
							}

						}

					}

				}

			}
			if (event.keyCode == 37) { // 左方向键
				if (myinputobj[nowfocus].selectionStart == 0) {
					if (myinputobj[nowfocus].selectionStart == myinputobj[nowfocus].selectionEnd) {
						if (nowfocus > 0) { // 如果不是第一行
							nowfocus--;
							myinputobj[nowfocus].focus();
							event.preventDefault();
							let l = myinputobj[nowfocus].value.length;
							myinputobj[nowfocus].setSelectionRange(l, l);
						}
					}
				}
			}

		}

		function onfinish() { //打字完成时运行此处
			isinputing = false;
			// isfinishdialogshowed = true;

			let usedtime = secondstotime(time);
			$(".finishdialog-usedtime").html("用时：" + usedtime);
			let correctrate = getcorrectrate();
			writetitle(articletitle, time, correctrate);
			$(".finishdialog-correctrate").html("正确率：" + correctrate + "%");
			$(".finishdialog-totalinput").html("输入字数：" + getallentercontent().length);

			$(".finishdialog").show();
			let windowwidth = window.innerWidth;
			let windowheight = window.innerHeight;
			let finishdialog = document.getElementsByClassName("finishdialog")[0];
			let finishdialogwidth = finishdialog.scrollWidth;
			let finishdialogheight = finishdialog.scrollHeight;

			finishdialog.style.top = parseInt((windowheight - finishdialogheight) / 2) + "px";
			finishdialog.style.left = parseInt((windowwidth - finishdialogwidth) / 2) + "px";


		}

		function onfocus(myobj) {
			let mylineid = myobj.getAttribute("lineid");
			nowfocus = mylineid;
			//myobj.scrollIntoView(false);

			//parent.scrollTo(0,100)

		}


		function getallentercontent() {
			let all = "";
			for (let i = 0; i < list.length; i++) {
				all += getentercontent(i);
			}
			return all;

		}
		//console.log(getallentercontent());
		//getAttribute()
		function formattime(t) {
			if (t == 0) {
				return "00";
			} else if (t < 10) {
				return "0" + t;
			} else {
				return "" + t;
			}
		}

		function mytime() {
			if (isinputing) {
				time++;
				writetitle(articletitle, time, getcorrectrate())

				setCookie("time", time, 36500)
				//console.log(hour + ":" + formattime(min) + ":" + formattime(second));
			}
		}

		var finishdialogshowtype = "first";

		function windowonkeydown(event) {
			// console.log(event.keyCode);
			// console.log(event.altKey);
			if (event.altKey && event.keyCode == 80) { // Alt+P
				isinputing = false;
			}

			if (event.keyCode == 13) { // Enter键
				// console.log(111);
				// event.preventDefault();
				// if (isfinishdialogshowed) {
				// 	if (finishdialogshowtype == "first") {
				// 		finishdialogshowtype = "second";
				// 	} else if (finishdialogshowtype == "second") {
				// 		$(".finishdialog").hide();
				// 		isfinishdialogshowed = false;
				// 		finishdialogshowtype = "first";
				// 	}

				// }
			}
		}

		function secondstotime(seconds) {
			let hour = parseInt(seconds / (60 * 60));
			let time2 = seconds - (hour * 60 * 60);
			let min = parseInt(time2 / 60);
			let second = time2 - (min * 60);
			let timeoutput = hour + ":" + formattime(min) + ":" + formattime(second);
			return timeoutput;
		}

		function autowritetitle() {
			writetitle(articletitle, time, getcorrectrate())
		}



		function writetitle(mytitle, mytime, mycorrectrate) {

			let autonextlineopentext = '<a onclick="autonextlineopen()" href="#">打开自动换行</a>';
			let autonextlineclosetext = '<a onclick="autonextlineclose()" href="#">关闭自动换行</a>';
			//console.log(autonextline);
			if (autonextline) {
				autonextlinetext = autonextlineclosetext;
			} else {
				autonextlinetext = autonextlineopentext;
			}

			let timeoutput = secondstotime(mytime);

			let speedStrOut = "";

			if (isShowSpeed) {
				let speedStr1 = "速度：";
				let speedStr2 = "char/min&nbsp;&nbsp;";
				speedStrOut = speedStr1 + speed + speedStr2;
			}

			let titleoutput = mytitle + "&nbsp;&nbsp;已用时间:" + timeoutput + "(Alt+P暂停)&nbsp;&nbsp;正确率:" + mycorrectrate +
				"%&nbsp;&nbsp;" + speedStrOut + autonextlinetext +
				"&nbsp;&nbsp;<a onclick='onopensetting()' href='#'>设置</a>&nbsp;&nbsp;<a class='back' href='index.html'>返回</a>";

			$(".title1").html(titleoutput);
		}

		window.onresize = function() {
			let windowwidth = window.innerWidth;
			//window.innerHeight
			$(".title1").width(windowwidth);
			createpage0();
		}

		function gettotalinput() {
			return entered.length;
		}


		function onfinishdialogok() {
			$(".finishdialog").hide();
		}

		function autonextlineopen() {
			autonextline = true;
			setCookie("autonextline", autonextline, 36500);
			autowritetitle();
		}

		function autonextlineclose() {
			autonextline = false;
			setCookie("autonextline", autonextline, 36500);
			autowritetitle();
		}

































		function onopensetting() { //settingModal
			$("#settingModal").modal("show");



			$(".setting-fontsize").val(fontsize);
			let mytitlecolor = document.getElementsByClassName("titlecolorset")[0];
			mytitlecolor.value = titlecolor;
			$(".colortext-title").val(titlecolor);

			let myline1color = document.getElementsByClassName("line1colorset")[0];
			myline1color.value = line1color;
			$(".colortext-line1").val(line1color);

			let myline2color = document.getElementsByClassName("line2colorset")[0];
			myline2color.value = line2color;
			$(".colortext-line2").val(line2color);


			let ifShowSpeedCheckbox = document.getElementsByClassName("ifshowspeed")[0];

			ifShowSpeedCheckbox.checked = isShowSpeed;




		}


		function onsettingModalSave() { //"fontsize"
			let colortexttitle = document.getElementsByClassName("colortext-title")[0];
			if (colortexttitle.getAttribute("isinvalid") == "yes") {
				return;
			}

			let colortextline1 = document.getElementsByClassName("colortext-line1")[0];
			if (colortextline1.getAttribute("isinvalid") == "yes") {
				return;
			}

			let colortextline2 = document.getElementsByClassName("colortext-line2")[0];
			if (colortextline2.getAttribute("isinvalid") == "yes") {
				return;
			}



			setCookie("fontsize", $(".setting-fontsize").val(), 36500);

			let mytitlecolor = document.getElementsByClassName("colortext-title")[0].value;

			if (mytitlecolor != defaulttitlecolor) {
				setCookie("titlecolor", mytitlecolor, 36500);
			} else {
				setCookie("titlecolor", "", 0);
			}

			let myline1color = document.getElementsByClassName("colortext-line1")[0].value;
			if (myline1color != defaultline1color) {
				setCookie("line1color", myline1color, 36500);
			} else {
				setCookie("line1color", "", 0);
			}

			let myline2color = document.getElementsByClassName("line2colorset")[0].value;
			if (myline2color != defaultline2color) {
				setCookie("line2color", myline2color, 36500);
			} else {
				setCookie("line2color", "", 0);
			}

			let ifShowSpeedCheckbox = document.getElementsByClassName("ifshowspeed")[0];
			if (ifShowSpeedCheckbox.checked) {
				setCookie("isshowspeed", true, 0);
			} else {
				setCookie("isshowspeed", false, 36500);
			}

			$("#settingModal").modal("hide");

			location.reload();

		}

		function onsettingModalCancel() {

			settitlecolor(titlecolor);
			setline1color(line1color);
			setline2color(line2color);

			//$("#settingModal").modal("hide");
		}

		function onchangetitlecolor(myobj) {
			settitlecolor(myobj.value);
			$(".colortext-title").val(myobj.value);
			checktitlecolortext();

		}

		function settitlecolor(color) {
			let mytitle = document.getElementsByClassName("title1")[0];
			mytitle.style.backgroundColor = color;
		}

		function titlecolortodefault() {
			let mycolor = document.getElementsByClassName("titlecolorset")[0];
			mycolor.value = defaulttitlecolor;
			settitlecolor(defaulttitlecolor);
			$(".colortext-title").val(defaulttitlecolor);
			checktitlecolortext();
		}

		function onchangeline1color(myobj) {
			setline1color(myobj.value);
			$(".colortext-line1").val(myobj.value);
			checkline1colortext();
		}

		function setline1color(color) {
			//inputtipobj
			for (let i = 0; i < inputtipobj.length; i++) {
				if ((i + 1) % 2 === 0) {
					//console.log('是偶数');
				} else {
					//console.log('是奇数');
					inputtipobj[i].style.backgroundColor = color;
					inputtipobj[i].style.borderColor = color;
				}
			}
		}

		function onchangeline2color(myobj) {
			setline2color(myobj.value);
			$(".colortext-line2").val(myobj.value);
			checkline2colortext();
		}

		function setline2color(color) {
			//inputtipobj
			for (let i = 0; i < inputtipobj.length; i++) {
				if ((i + 1) % 2 === 0) {
					//console.log('是偶数');
					inputtipobj[i].style.backgroundColor = color;
					inputtipobj[i].style.borderColor = color;
				} else {
					//console.log('是奇数');
				}
			}
		}

		function line1colortodefault() {
			let line1colorset = document.getElementsByClassName("line1colorset")[0];
			line1colorset.value = defaultline1color;
			$(".colortext-line1").val(defaultline1color);
			checkline1colortext();
			setline1color(defaultline1color);
		}

		function line2colortodefault() {
			let line2colorset = document.getElementsByClassName("line2colorset")[0];
			line2colorset.value = defaultline2color;
			$(".colortext-line2").val(defaultline2color);
			checkline2colortext();
			setline2color(defaultline2color);

		}

		function iscolortext(val) {
			return iscolorreg.test(val);
		}

		function onchangetitlecolortext() {
			checktitlecolortext();
			let colortexttitle = document.getElementsByClassName("colortext-title")[0];
			let mytitlecolorset = document.getElementsByClassName("titlecolorset")[0];
			if (colortexttitle.getAttribute("isinvalid") == "no") {
				mytitlecolorset.value = colortexttitle.value;
				settitlecolor(colortexttitle.value);
			}
		}

		function checktitlecolortext() {

			let titlecolorclass = "form-control form-control-sm colortext colortext-title";
			let colortexttitle = document.getElementsByClassName("colortext-title")[0];
			if (iscolortext(colortexttitle.value)) {
				colortexttitle.className = titlecolorclass;
				colortexttitle.setAttribute("isinvalid", "no");
			} else {
				colortexttitle.className = titlecolorclass + " is-invalid";
				colortexttitle.setAttribute("isinvalid", "yes");
			}
		}

		function onchangeline1colortext() {
			checkline1colortext();

			let colortextline1 = document.getElementsByClassName("colortext-line1")[0];
			let myline1colorset = document.getElementsByClassName("line1colorset")[0];
			if (colortextline1.getAttribute("isinvalid") == "no") {
				myline1colorset.value = colortextline1.value;
				setline1color(colortextline1.value);

			}
		}

		function checkline1colortext() {
			let line1colorclass = "form-control form-control-sm colortext colortext-line1";
			let colortextline1 = document.getElementsByClassName("colortext-line1")[0];
			if (iscolortext(colortextline1.value)) {
				colortextline1.className = line1colorclass;
				colortextline1.setAttribute("isinvalid", "no");
			} else {
				colortextline1.className = line1colorclass + " is-invalid";
				colortextline1.setAttribute("isinvalid", "yes");
			}
		}

		function onchangeline2colortext() {
			checkline2colortext();

			let colortextline2 = document.getElementsByClassName("colortext-line2")[0];
			let myline2colorset = document.getElementsByClassName("line2colorset")[0];
			if (colortextline2.getAttribute("isinvalid") == "no") {
				myline2colorset.value = colortextline2.value;
				setline2color(colortextline2.value);
			}
		}

		function checkline2colortext() {
			let line2colorclass = "form-control form-control-sm colortext colortext-line2";
			let colortextline2 = document.getElementsByClassName("colortext-line2")[0];
			if (iscolortext(colortextline2.value)) {
				colortextline2.className = line2colorclass;
				colortextline2.setAttribute("isinvalid", "no");
			} else {
				colortextline2.className = line2colorclass + " is-invalid";
				colortextline2.setAttribute("isinvalid", "yes");
			}
		}

		function getSpeedIndex2() {

		}



		function mytime2() {
			if (isShowSpeed && isinputing) {

				speedLengthArray.shift();

				speedLengthArray.push(getallentercontent().length);

				let speed0 = speedLengthArray[speedSpacing] - speedLengthArray[0];

				speed = speed0 / speedSpacing * 60;
				// console.log(speed);
			}
		}
	</script>
</html>